{"id":"node_modules/@snap/camera-kit/lib/handlers/noCorsRetryingFetchHandler.js","dependencies":[{"name":"/Users/eneto/Lab/snap-rca-camkit-workshop/node_modules/@snap/camera-kit/lib/handlers/noCorsRetryingFetchHandler.js.map","includedInParent":true,"mtime":1710948721258},{"name":"/Users/eneto/Lab/snap-rca-camkit-workshop/package.json","includedInParent":true,"mtime":1710952305120},{"name":"/Users/eneto/Lab/snap-rca-camkit-workshop/node_modules/@snap/camera-kit/package.json","includedInParent":true,"mtime":1710948721086},{"name":"tslib","loc":{"line":1,"column":26,"index":26},"parent":"/Users/eneto/Lab/snap-rca-camkit-workshop/node_modules/@snap/camera-kit/lib/handlers/noCorsRetryingFetchHandler.js","resolved":"/Users/eneto/Lab/snap-rca-camkit-workshop/node_modules/@snap/camera-kit/node_modules/tslib/tslib.es6.js"},{"name":"../logger/logger","loc":{"line":2,"column":26,"index":61},"parent":"/Users/eneto/Lab/snap-rca-camkit-workshop/node_modules/@snap/camera-kit/lib/handlers/noCorsRetryingFetchHandler.js","resolved":"/Users/eneto/Lab/snap-rca-camkit-workshop/node_modules/@snap/camera-kit/lib/logger/logger.js"},{"name":"./retryingHandler","loc":{"line":3,"column":36,"index":117},"parent":"/Users/eneto/Lab/snap-rca-camkit-workshop/node_modules/@snap/camera-kit/lib/handlers/noCorsRetryingFetchHandler.js","resolved":"/Users/eneto/Lab/snap-rca-camkit-workshop/node_modules/@snap/camera-kit/lib/handlers/retryingHandler.js"}],"generated":{"js":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.createNoCorsRetryingFetchHandler = void 0;\nvar _tslib = require(\"tslib\");\nvar _logger = require(\"../logger/logger\");\nvar _retryingHandler = require(\"./retryingHandler\");\nconst logger = (0, _logger.getLogger)(\"noCorsRetryingFetchHandler\");\nconst logRetry = error => {\n  logger.warn(`NoCorsRetrying handler got failed response:`, error, `Retrying request with {mode: \"no-cors\"}.`);\n};\n/**\n * Some requests may require a no-cors pre-flight (which are allowed to follow redirects) before they can be\n * successful.\n *\n * An example is a federated identity authentication flow, like OpenID Connect or OAuth. In many such schemes,\n * an unauthenticated request will not include CORs headers. Instead, a redirect to an Identity Provider will be\n * returned. In order follow this redirect, the Fetch request must be made with \"no-cors\" mode.\n *\n * Once the \"no-cors\" request is made, redirects are followed resulting in authentication cookies being set on the\n * original domain. Then, the original request can be retried and the server will authenticate the request and set\n * proper CORs headers on the response.\n *\n * Here's an example request flow, in which the page already has cookies for IdentityProvider.com (if that wasn't\n * the case, IdentityProvider.com would prompt the user for credentials and the rest of the flow would be the same):\n *\n * ```\n * WebPage a.com        MyServer b.com    IdentityProvider c.com\n *    |                         |                 |\n * Original request,            |                 |\n * unauthenticated:             |                 |\n *    |------------------------>|                 |\n *    |<--302: c.com, no CORs---|                 |\n *    |                         |                 |\n *    |                         |                 |\n * No CORs headers in           |                 |\n * response. Retry in           |                 |\n * \"no-cors\" mode:              |                 |\n *    |-----\"no-cors\" mode----->|                 |\n *    |<--302: c.com, no CORs---|                 |\n *    |                         |                 |\n *    |                         |                 |\n *    |------------------IdP cookies------------->|\n *    |<----------302: b.com?token=foo------------|\n *                              |                 |\n *    |                         |                 |\n *    |----b.com?token=foo----->|                 |\n *    |<-302: b.com, set cookie-|                 |\n *    |                         |                 |\n *    |                         |                 |\n * Retry original request,      |                 |\n * now authenticated:           |                 |\n *    |-----------cookie------->|                 |\n *    |<-----------200----------|                 |\n *                              |                 |\n * ```\n */\nconst createNoCorsRetryingFetchHandler = () => {\n  // If concurrent requests are made to the same domain, we only want to perform one \"no-cors\" request. We assume\n  // requests to the same domain will set the same authentication cookies. To support this, we'll store any\n  // in-flight \"no-cors\" retries and re-use them for concurrent requests.\n  const noCorsRequests = new Map();\n  return next => (input, init = {}) => (0, _tslib.__awaiter)(void 0, void 0, void 0, function* () {\n    var _a;\n    // `host` includes domain:port, so works for local development. If the input is a relative path, we'll\n    // use `location.origin` to resolve into a fully qualified URL (although of course we don't actually\n    // anticipate any CORs issues in that case -- but this is cleaner than special-casing).\n    let requestKey = typeof input === \"string\" ? input : input.url;\n    try {\n      requestKey = new URL(requestKey, location.origin).host;\n    } catch (_) {\n      /* no-op, use the full input URL as the requestKey */\n    }\n    try {\n      // By always attempting the request first, we avoid needing to maintain any state about the validity\n      // of the request (e.g. the expiration time for a credential). We just make the request, and if it\n      // fails, this tells us we've made an invalid request. This does result in one additional request, but\n      // it makes this much more flexible and avoids having to maintain state (which can be a source of bugs).\n      return yield next((0, _retryingHandler.ensureClonedRequest)(input), init);\n    } catch (error) {\n      // If the request fails because it was aborted, we assume this was done intentionally and we can stop.\n      if (error instanceof Error && error.name === \"AbortError\") throw error;\n      // Otherwise we don't actually care what error occurred â€“ we know this will be an error thrown by\n      // `fetch` itself (rather than some error encountered on the server, which wouldn't cause `next` to\n      // throw), and we'll just assume it's a CORs error. If it's not, we'll perform a \"no-cors\" retry anyway,\n      // which will presumably also fail, and that failure will be returned to the caller.\n      logRetry(error);\n      const noCorsRequest = (_a = noCorsRequests.get(requestKey)) !== null && _a !== void 0 ? _a : next((0, _retryingHandler.ensureClonedRequest)(input), Object.assign(Object.assign({}, init), {\n        mode: \"no-cors\"\n      }));\n      noCorsRequests.set(requestKey, noCorsRequest);\n      yield noCorsRequest;\n      noCorsRequests.delete(requestKey);\n      return next((0, _retryingHandler.ensureClonedRequest)(input), init);\n    }\n  });\n};\nexports.createNoCorsRetryingFetchHandler = createNoCorsRetryingFetchHandler;"},"sourceMaps":{"js":{"mappings":[{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":8,"column":0}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":8,"column":4}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":8,"column":11}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":8,"column":14}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":8,"column":21}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":3,"column":0},"generated":{"line":9,"column":0}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":3,"column":0},"generated":{"line":9,"column":4}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":3,"column":0},"generated":{"line":9,"column":20}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":3,"column":0},"generated":{"line":9,"column":23}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":3,"column":0},"generated":{"line":9,"column":30}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":5,"column":0},"generated":{"line":10,"column":0}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":5,"column":6},"generated":{"line":10,"column":6}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":5,"column":12},"generated":{"line":10,"column":12}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":5,"column":15},"generated":{"line":10,"column":15}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":5,"column":15},"generated":{"line":10,"column":19}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":5,"column":24},"generated":{"line":10,"column":36}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":5,"column":25},"generated":{"line":10,"column":38}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":5,"column":53},"generated":{"line":10,"column":66}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":5,"column":54},"generated":{"line":10,"column":67}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":7,"column":0},"generated":{"line":11,"column":0}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":7,"column":6},"generated":{"line":11,"column":6}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":7,"column":14},"generated":{"line":11,"column":14}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":7,"column":18},"generated":{"line":11,"column":17}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":7,"column":28},"generated":{"line":11,"column":22}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":7,"column":32},"generated":{"line":11,"column":26}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":8,"column":4},"generated":{"line":12,"column":2}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":8,"column":10},"generated":{"line":12,"column":8}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":8,"column":11},"generated":{"line":12,"column":9}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":8,"column":15},"generated":{"line":12,"column":13}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":8,"column":16},"generated":{"line":12,"column":14}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":8,"column":61},"generated":{"line":12,"column":59}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":8,"column":63},"generated":{"line":12,"column":61}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":8,"column":68},"generated":{"line":12,"column":66}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":8,"column":70},"generated":{"line":12,"column":68}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":8,"column":112},"generated":{"line":12,"column":110}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":8,"column":113},"generated":{"line":12,"column":111}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":9,"column":0},"generated":{"line":13,"column":0}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":9,"column":1},"generated":{"line":13,"column":1}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":11,"column":0},"generated":{"line":14,"column":0}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":57,"column":7},"generated":{"line":60,"column":0}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":57,"column":13},"generated":{"line":60,"column":6}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":57,"column":45},"generated":{"line":60,"column":38}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":57,"column":48},"generated":{"line":60,"column":41}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":57,"column":48},"generated":{"line":60,"column":42}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":63,"column":4},"generated":{"line":60,"column":47}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":64,"column":4},"generated":{"line":61,"column":2}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":65,"column":4},"generated":{"line":62,"column":2}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":66,"column":4},"generated":{"line":63,"column":2}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":67,"column":4},"generated":{"line":64,"column":2}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":67,"column":10},"generated":{"line":64,"column":8}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":67,"column":24},"generated":{"line":64,"column":22}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":67,"column":27},"generated":{"line":64,"column":25}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":67,"column":31},"generated":{"line":64,"column":29}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":67,"column":34},"generated":{"line":64,"column":32}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":67,"column":34},"generated":{"line":64,"column":33}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":67,"column":58},"generated":{"line":64,"column":34}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":69,"column":4},"generated":{"line":65,"column":2}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":69,"column":12},"generated":{"line":65,"column":9}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":69,"column":16},"generated":{"line":65,"column":13}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":70,"column":8},"generated":{"line":65,"column":17}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":70,"column":15},"generated":{"line":65,"column":18}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":70,"column":20},"generated":{"line":65,"column":23}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":70,"column":22},"generated":{"line":65,"column":25}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":70,"column":26},"generated":{"line":65,"column":29}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":70,"column":29},"generated":{"line":65,"column":32}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":70,"column":29},"generated":{"line":65,"column":33}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":70,"column":31},"generated":{"line":65,"column":34}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":70,"column":35},"generated":{"line":65,"column":39}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":70,"column":35},"generated":{"line":65,"column":43}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":70,"column":35},"generated":{"line":65,"column":59}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":70,"column":35},"generated":{"line":65,"column":61}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":70,"column":35},"generated":{"line":65,"column":66}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":70,"column":35},"generated":{"line":65,"column":67}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":70,"column":35},"generated":{"line":65,"column":69}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":70,"column":35},"generated":{"line":65,"column":74}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":70,"column":35},"generated":{"line":65,"column":75}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":70,"column":35},"generated":{"line":65,"column":77}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":70,"column":35},"generated":{"line":65,"column":82}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":70,"column":35},"generated":{"line":65,"column":83}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":70,"column":35},"generated":{"line":65,"column":85}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":70,"column":35},"generated":{"line":65,"column":98}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":71,"column":12},"generated":{"line":67,"column":4}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":72,"column":12},"generated":{"line":68,"column":4}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":73,"column":12},"generated":{"line":69,"column":4}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":74,"column":12},"generated":{"line":70,"column":4}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":74,"column":16},"generated":{"line":70,"column":8}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":74,"column":26},"generated":{"line":70,"column":18}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":74,"column":29},"generated":{"line":70,"column":21}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":74,"column":36},"generated":{"line":70,"column":28}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":74,"column":41},"generated":{"line":70,"column":33}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":74,"column":46},"generated":{"line":70,"column":38}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":74,"column":54},"generated":{"line":70,"column":46}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":74,"column":57},"generated":{"line":70,"column":49}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":74,"column":62},"generated":{"line":70,"column":54}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":74,"column":65},"generated":{"line":70,"column":57}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":74,"column":70},"generated":{"line":70,"column":62}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":74,"column":71},"generated":{"line":70,"column":63}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":74,"column":74},"generated":{"line":70,"column":66}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":75,"column":12},"generated":{"line":71,"column":4}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":75,"column":16},"generated":{"line":71,"column":8}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":76,"column":16},"generated":{"line":72,"column":6}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":76,"column":26},"generated":{"line":72,"column":16}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":76,"column":29},"generated":{"line":72,"column":19}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":76,"column":33},"generated":{"line":72,"column":23}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":76,"column":36},"generated":{"line":72,"column":26}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":76,"column":37},"generated":{"line":72,"column":27}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":76,"column":47},"generated":{"line":72,"column":37}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":76,"column":49},"generated":{"line":72,"column":39}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":76,"column":57},"generated":{"line":72,"column":47}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":76,"column":58},"generated":{"line":72,"column":48}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":76,"column":64},"generated":{"line":72,"column":54}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":76,"column":65},"generated":{"line":72,"column":55}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":76,"column":66},"generated":{"line":72,"column":56}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":76,"column":70},"generated":{"line":72,"column":60}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":77,"column":13},"generated":{"line":73,"column":5}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":77,"column":14},"generated":{"line":73,"column":6}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":77,"column":21},"generated":{"line":73,"column":13}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":77,"column":22},"generated":{"line":73,"column":14}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":77,"column":24},"generated":{"line":73,"column":16}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":78,"column":16},"generated":{"line":74,"column":6}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":78,"column":16},"generated":{"line":75,"column":4}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":81,"column":12},"generated":{"line":76,"column":4}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":81,"column":16},"generated":{"line":76,"column":8}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":82,"column":16},"generated":{"line":77,"column":6}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":83,"column":16},"generated":{"line":78,"column":6}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":84,"column":16},"generated":{"line":79,"column":6}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":85,"column":16},"generated":{"line":80,"column":6}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":86,"column":16},"generated":{"line":81,"column":6}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":86,"column":23},"generated":{"line":81,"column":13}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":86,"column":29},"generated":{"line":81,"column":19}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":86,"column":33},"generated":{"line":81,"column":23}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":86,"column":34},"generated":{"line":81,"column":24}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":86,"column":34},"generated":{"line":81,"column":28}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":86,"column":53},"generated":{"line":81,"column":64}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":86,"column":54},"generated":{"line":81,"column":66}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":86,"column":59},"generated":{"line":81,"column":71}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":86,"column":60},"generated":{"line":81,"column":72}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":86,"column":62},"generated":{"line":81,"column":74}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":86,"column":66},"generated":{"line":81,"column":78}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":86,"column":67},"generated":{"line":81,"column":79}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":87,"column":13},"generated":{"line":82,"column":5}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":87,"column":14},"generated":{"line":82,"column":6}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":87,"column":21},"generated":{"line":82,"column":13}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":87,"column":26},"generated":{"line":82,"column":18}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":87,"column":28},"generated":{"line":82,"column":20}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":88,"column":16},"generated":{"line":83,"column":6}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":89,"column":16},"generated":{"line":84,"column":6}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":89,"column":20},"generated":{"line":84,"column":10}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":89,"column":25},"generated":{"line":84,"column":15}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":89,"column":37},"generated":{"line":84,"column":27}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":89,"column":42},"generated":{"line":84,"column":32}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":89,"column":46},"generated":{"line":84,"column":36}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":89,"column":51},"generated":{"line":84,"column":41}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":89,"column":52},"generated":{"line":84,"column":42}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":89,"column":56},"generated":{"line":84,"column":46}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":89,"column":61},"generated":{"line":84,"column":51}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":89,"column":73},"generated":{"line":84,"column":63}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":89,"column":75},"generated":{"line":84,"column":65}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":89,"column":81},"generated":{"line":84,"column":71}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":89,"column":86},"generated":{"line":84,"column":76}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":91,"column":16},"generated":{"line":85,"column":6}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":92,"column":16},"generated":{"line":86,"column":6}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":93,"column":16},"generated":{"line":87,"column":6}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":94,"column":16},"generated":{"line":88,"column":6}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":95,"column":16},"generated":{"line":89,"column":6}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":95,"column":24},"generated":{"line":89,"column":14}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":95,"column":25},"generated":{"line":89,"column":15}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":95,"column":30},"generated":{"line":89,"column":20}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":95,"column":31},"generated":{"line":89,"column":21}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":96,"column":16},"generated":{"line":90,"column":6}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":96,"column":22},"generated":{"line":90,"column":12}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":96,"column":35},"generated":{"line":90,"column":25}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":20},"generated":{"line":90,"column":28}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":20},"generated":{"line":90,"column":29}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":20},"generated":{"line":90,"column":31}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":20},"generated":{"line":90,"column":34}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":34},"generated":{"line":90,"column":48}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":35},"generated":{"line":90,"column":49}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":38},"generated":{"line":90,"column":52}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":39},"generated":{"line":90,"column":53}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":49},"generated":{"line":90,"column":63}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":50},"generated":{"line":90,"column":64}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":50},"generated":{"line":90,"column":70}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":50},"generated":{"line":90,"column":74}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":50},"generated":{"line":90,"column":78}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":50},"generated":{"line":90,"column":80}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":50},"generated":{"line":90,"column":85}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":50},"generated":{"line":90,"column":90}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":50},"generated":{"line":90,"column":91}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":50},"generated":{"line":90,"column":94}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":50},"generated":{"line":90,"column":96}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":54},"generated":{"line":90,"column":99}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":58},"generated":{"line":90,"column":103}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":59},"generated":{"line":90,"column":104}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":59},"generated":{"line":90,"column":108}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":78},"generated":{"line":90,"column":144}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":79},"generated":{"line":90,"column":146}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":84},"generated":{"line":90,"column":151}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":85},"generated":{"line":90,"column":152}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":85},"generated":{"line":90,"column":154}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":85},"generated":{"line":90,"column":160}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":85},"generated":{"line":90,"column":161}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":85},"generated":{"line":90,"column":167}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":85},"generated":{"line":90,"column":168}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":85},"generated":{"line":90,"column":174}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":85},"generated":{"line":90,"column":175}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":85},"generated":{"line":90,"column":181}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":85},"generated":{"line":90,"column":182}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":85},"generated":{"line":90,"column":183}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":85},"generated":{"line":90,"column":184}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":92},"generated":{"line":90,"column":186}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":96},"generated":{"line":90,"column":190}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":96},"generated":{"line":90,"column":191}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":96},"generated":{"line":90,"column":193}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":98},"generated":{"line":91,"column":8}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":102},"generated":{"line":91,"column":12}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":104},"generated":{"line":91,"column":14}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":113},"generated":{"line":92,"column":6}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":113},"generated":{"line":92,"column":7}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":113},"generated":{"line":92,"column":8}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":97,"column":116},"generated":{"line":92,"column":9}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":98,"column":16},"generated":{"line":93,"column":6}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":98,"column":30},"generated":{"line":93,"column":20}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":98,"column":31},"generated":{"line":93,"column":21}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":98,"column":34},"generated":{"line":93,"column":24}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":98,"column":35},"generated":{"line":93,"column":25}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":98,"column":45},"generated":{"line":93,"column":35}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":98,"column":47},"generated":{"line":93,"column":37}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":98,"column":60},"generated":{"line":93,"column":50}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":98,"column":61},"generated":{"line":93,"column":51}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":99,"column":16},"generated":{"line":94,"column":6}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":99,"column":22},"generated":{"line":94,"column":12}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":99,"column":35},"generated":{"line":94,"column":25}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":100,"column":16},"generated":{"line":95,"column":6}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":100,"column":30},"generated":{"line":95,"column":20}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":100,"column":31},"generated":{"line":95,"column":21}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":100,"column":37},"generated":{"line":95,"column":27}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":100,"column":38},"generated":{"line":95,"column":28}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":100,"column":48},"generated":{"line":95,"column":38}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":100,"column":49},"generated":{"line":95,"column":39}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":101,"column":16},"generated":{"line":96,"column":6}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":101,"column":23},"generated":{"line":96,"column":13}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":101,"column":27},"generated":{"line":96,"column":17}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":101,"column":28},"generated":{"line":96,"column":18}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":101,"column":28},"generated":{"line":96,"column":22}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":101,"column":47},"generated":{"line":96,"column":58}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":101,"column":48},"generated":{"line":96,"column":60}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":101,"column":53},"generated":{"line":96,"column":65}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":101,"column":54},"generated":{"line":96,"column":66}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":101,"column":56},"generated":{"line":96,"column":68}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":101,"column":60},"generated":{"line":96,"column":72}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":101,"column":61},"generated":{"line":96,"column":73}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":103,"column":8},"generated":{"line":98,"column":2}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":103,"column":9},"generated":{"line":98,"column":3}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":103,"column":9},"generated":{"line":98,"column":4}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":104,"column":0},"generated":{"line":99,"column":0}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":104,"column":1},"generated":{"line":99,"column":1}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":104,"column":2},"generated":{"line":100,"column":0}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":104,"column":2},"generated":{"line":100,"column":7}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":104,"column":2},"generated":{"line":100,"column":8}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":104,"column":2},"generated":{"line":100,"column":40}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":104,"column":2},"generated":{"line":100,"column":43}},{"source":"../../src/handlers/noCorsRetryingFetchHandler.ts","name":null,"original":{"line":104,"column":2},"generated":{"line":100,"column":75}}],"sources":{"../../src/handlers/noCorsRetryingFetchHandler.ts":"import { getLogger } from \"../logger/logger\";\nimport { ChainableHandler } from \"./HandlerChainBuilder\";\nimport { ensureClonedRequest } from \"./retryingHandler\";\n\nconst logger = getLogger(\"noCorsRetryingFetchHandler\");\n\nconst logRetry = (error: any) => {\n    logger.warn(`NoCorsRetrying handler got failed response:`, error, `Retrying request with {mode: \"no-cors\"}.`);\n};\n\n/**\n * Some requests may require a no-cors pre-flight (which are allowed to follow redirects) before they can be\n * successful.\n *\n * An example is a federated identity authentication flow, like OpenID Connect or OAuth. In many such schemes,\n * an unauthenticated request will not include CORs headers. Instead, a redirect to an Identity Provider will be\n * returned. In order follow this redirect, the Fetch request must be made with \"no-cors\" mode.\n *\n * Once the \"no-cors\" request is made, redirects are followed resulting in authentication cookies being set on the\n * original domain. Then, the original request can be retried and the server will authenticate the request and set\n * proper CORs headers on the response.\n *\n * Here's an example request flow, in which the page already has cookies for IdentityProvider.com (if that wasn't\n * the case, IdentityProvider.com would prompt the user for credentials and the rest of the flow would be the same):\n *\n * ```\n * WebPage a.com        MyServer b.com    IdentityProvider c.com\n *    |                         |                 |\n * Original request,            |                 |\n * unauthenticated:             |                 |\n *    |------------------------>|                 |\n *    |<--302: c.com, no CORs---|                 |\n *    |                         |                 |\n *    |                         |                 |\n * No CORs headers in           |                 |\n * response. Retry in           |                 |\n * \"no-cors\" mode:              |                 |\n *    |-----\"no-cors\" mode----->|                 |\n *    |<--302: c.com, no CORs---|                 |\n *    |                         |                 |\n *    |                         |                 |\n *    |------------------IdP cookies------------->|\n *    |<----------302: b.com?token=foo------------|\n *                              |                 |\n *    |                         |                 |\n *    |----b.com?token=foo----->|                 |\n *    |<-302: b.com, set cookie-|                 |\n *    |                         |                 |\n *    |                         |                 |\n * Retry original request,      |                 |\n * now authenticated:           |                 |\n *    |-----------cookie------->|                 |\n *    |<-----------200----------|                 |\n *                              |                 |\n * ```\n */\nexport const createNoCorsRetryingFetchHandler = <Res>(): ChainableHandler<\n    RequestInfo,\n    Res,\n    RequestInfo,\n    Res,\n    RequestInit | undefined\n> => {\n    // If concurrent requests are made to the same domain, we only want to perform one \"no-cors\" request. We assume\n    // requests to the same domain will set the same authentication cookies. To support this, we'll store any\n    // in-flight \"no-cors\" retries and re-use them for concurrent requests.\n    const noCorsRequests = new Map<string, Promise<Res>>();\n\n    return (next) =>\n        async (input, init = {}) => {\n            // `host` includes domain:port, so works for local development. If the input is a relative path, we'll\n            // use `location.origin` to resolve into a fully qualified URL (although of course we don't actually\n            // anticipate any CORs issues in that case -- but this is cleaner than special-casing).\n            let requestKey = typeof input === \"string\" ? input : input.url;\n            try {\n                requestKey = new URL(requestKey, location.origin).host;\n            } catch (_) {\n                /* no-op, use the full input URL as the requestKey */\n            }\n\n            try {\n                // By always attempting the request first, we avoid needing to maintain any state about the validity\n                // of the request (e.g. the expiration time for a credential). We just make the request, and if it\n                // fails, this tells us we've made an invalid request. This does result in one additional request, but\n                // it makes this much more flexible and avoids having to maintain state (which can be a source of bugs).\n                return await next(ensureClonedRequest(input), init);\n            } catch (error) {\n                // If the request fails because it was aborted, we assume this was done intentionally and we can stop.\n                if (error instanceof Error && error.name === \"AbortError\") throw error;\n\n                // Otherwise we don't actually care what error occurred â€“ we know this will be an error thrown by\n                // `fetch` itself (rather than some error encountered on the server, which wouldn't cause `next` to\n                // throw), and we'll just assume it's a CORs error. If it's not, we'll perform a \"no-cors\" retry anyway,\n                // which will presumably also fail, and that failure will be returned to the caller.\n                logRetry(error);\n                const noCorsRequest =\n                    noCorsRequests.get(requestKey) ?? next(ensureClonedRequest(input), { ...init, mode: \"no-cors\" });\n                noCorsRequests.set(requestKey, noCorsRequest);\n                await noCorsRequest;\n                noCorsRequests.delete(requestKey);\n                return next(ensureClonedRequest(input), init);\n            }\n        };\n};\n"},"lineCount":null}},"error":null,"hash":"3634b6279579d5950dc794423df9a671","cacheData":{"env":{}}}